function PeepSo(){"undefined"!=typeof peepsodata&&(this.defaultUrl=peepsodata.ajaxurl,this.userId=parseInt(peepsodata.userid))}PeepSo.prototype={error:!1,errorText:"",errorStatus:"",callback:null,trxComplete:0,errorCallback:null,validationErrors:new Array,url:"",ret:0,timeout:0,enableValidation:1,formElementType:"td",async:!0,defaultUrl:null,userId:null,action:"",authRequired:!0,init:function(a,b){this.error=!1,this.errorText="",this.errorStatus="",this.callback=a,this.trxComplete=0,this.errorCallback=null,this.url=peepsodata.ajaxurl+b,this.action=b,this.timeout=0,this.enableValidation=1,this.async=!0},peepSoCallback:function(a){if(null===a)return void(this.trxComplete=1);try{if(this.authRequired&&"undefined"!=typeof a.session_timeout&&"auth.login"!==this.action)return jQuery(window).trigger("peepso_auth_required",[this,a]),void(this.trxComplete=1)}catch(b){}if("undefined"!=typeof a.focus&&null!==a.focus)if(null!==document.getElementById(a.focus))document.getElementById(a.focus).focus();else{var c="#"+a.form+' [name="'+a.focus+'"]';jQuery(c).focus()}try{if("undefined"!=typeof a.errors){var d="";if(a.errors.length>0){for(x=0;x<a.errors.length;x++)"undefined"!=typeof a.errors[x].error&&(d+="<p>"+a.errors[x].error+"</p>");""!==d&&pswindow.show(peepsodata.label_error,d)}}if("undefined"!=typeof a.notices){var e="";if(a.notices.length>0){for(x=0;x<a.notices.length;x++)"undefined"!=typeof a.notices[x].message&&(e+=a.notices[x].message+"\n");""!==e&&pswindow.show(peepsodata.label_notice,e)}}}catch(b){}"undefined"!=typeof a.success&&1===a.success&&"undefined"!=typeof a.form&&""!==a.form&&this.clearValidation(a.form);try{if(this.enableValidation&&"undefined"!=typeof a.validation&&"undefined"!=typeof a.form&&""!==a.form&&a.validation.length>0){this.clearValidation(a.form);var f=jQuery("#"+a.form);for(jQuery(f).addClass("validation-errors"),x=0;x<a.validation.length;x++){var g=jQuery('[name="'+a.validation[x].fieldName+'"]');jQuery(g).addClass("validation-error");var h=g.closest(this.formElementType);h.append('<div class="validation-msg">'+a.validation[x].errorMessage+"</div>")}}}catch(b){}if("function"==typeof this.callback)try{this.callback(a)}catch(b){}this.trxComplete=1},clearValidation:function(a){a=jQuery("#"+a),jQuery(a).find("div.validation-msg").each(function(){jQuery(this).remove()}),jQuery(a).find("input, select, textarea").each(function(){jQuery(this).removeClass("validation-error")}),jQuery(a).find(this.formElementType+".errorItem").each(function(){jQuery(this).removeClass("errorItem")})},get:function(a,b,c,d){var e=new PeepSo,f=this.timeout;return e.async=this.async,this.async=!0,target_url=peepsodata.ajaxurl+a,$PeepSo.log("target=["+target_url+"]"),e.init(c,a),("undefined"==typeof d||""===d)&&(d="json"),e.ret=jQuery.get(e.url,b,function(a){e.peepSoCallback(a)},d,{timeout:f},{async:e.async}),e},getJson:function(a,b,c){var d=new PeepSo;d.init(c,a),d.async=this.async,d.authRequired=this.authRequired,d.errorDisabled=this.errorDisabled,this.async=!0;var e={type:"GET",url:d.url,contentType:"application/json; charset=utf-8",dataType:"json",data:b,success:function(a){d.peepSoCallback(a)},error:function(a,b,c){d.ajaxError(a,b,c)},async:d.async};return this.authRequired=!0,this.errorDisabled=!1,jQuery.ajax(e)},post:function(a,b,c,d){var e=new PeepSo;return e.init(c,a),e.errorCallback=this.errorCallback,e.enableValidation=this.enableValidation,e.async=this.async,e.timeout=this.timeout,e.authRequired=this.authRequired,this.async=!0,("undefined"==typeof d||""===d)&&(d="json"),"json"===d?(e.ret=this.postJson(a,b,c),e):(e.ret=jQuery.post(e.url,b,function(a){e.peepSoCallback(a)},d,{timeout:this.timeout},{async:e.async}),this.authRequired=!0,e)},postElems:function(a,b,c,d){var e=new PeepSo;e.init(c,a),e.async=this.async,this.async=!0,("undefined"==typeof d||null===d)&&(d="json");var f=jQuery(b.container).find("input").serializeArray();return f=jQuery.merge(f,jQuery(b.container).find("select").serializeArray()),f=jQuery.merge(f,jQuery(b.container).find("textarea").serializeArray()),f.push({name:"action",value:b.action}),f.push({name:"req",value:b.req}),e.ret=jQuery.post(e.url,f,function(a){e.peepSoCallback(a)},d,{async:e.async}),e},postJson:function(a,b,c){var d=new PeepSo;d.init(c,a),d.async=this.async,d.authRequired=this.authRequired,d.errorDisabled=this.errorDisabled,d.errorCallback=this.errorCallback,d.enableValidation=this.enableValidation,this.async=!0;var e={type:"POST",url:d.url,dataType:"json",data:b,timeout:this.timeout,success:function(a){d.peepSoCallback(a)},error:function(a,b,c){d.ajaxError(a,b,c)},async:d.async};return d.ret=jQuery.post(e.url,b,function(a){e.success(a)},"json"),this.authRequired=!0,this.errorDisabled=!1,d},setTimeout:function(a){return this.timeout=a,this},setValidation:function(a){return"undefined"!=typeof a&&(a?this.enableValidation=1:this.enableValidation=0),this},disableAsync:function(){return this.async=!1,this},disableAuth:function(){return this.authRequired=!1,this},setErrorCallback:function(a){return this.errorCallback=a,this},setFormElement:function(a){return this.formElementType=a,this},ajaxError:function(a,b,c){this.error=!0,this.errorStatus=b||"","undefined"==typeof a?this.errorText="Undefined error.":this.errorText=a.responseText||"Connection timeout.",this.errorDisabled?this.log(this.errorStatus,this.errorText):pswindow.show(this.errorStatus,this.errorText),"function"==typeof this.errorCallback&&this.errorCallback()},enableError:function(){return this.errorDisabled=!1,this},disableError:function(){return this.errorDisabled=!0,this},log:function(){window.console&&console.log.apply(console,arguments)},screenSize:function(){var a,b=window.innerWidth;return a=360>=b?"xsmall":480>=b?"small":991>=b?"medium":"large"}},ppso=peepso=$PeepSo=new PeepSo,jQuery(document).ready(function(){jQuery(window).on("peepso_auth_required",function(a,b,c){jQuery(".login-area input").attr("disabled",!0),pswindow.is_visible&&pswindow.hide(),pswindow.show("Please login to continue",c.login_dialog),jQuery(document).trigger("peepso_login_shown"),jQuery("#ps-window").one("pswindow.hidden",function(){jQuery(".login-area input").removeAttr("disabled")})}),jQuery(".ps-tab-bar a[data-toggle=tab]").on("click.ps-tab",function(a){jQuery(a.target).addClass("active").siblings("a[data-toggle=tab]").removeClass("active")})}),ps_login={},ps_login.post_callback=function(a){a.success?document.location=a.data.url:a.has_errors&&jQuery("#errlogin").html(a.errors[0]).css("display","block")},ps_login.form_submit=function(a){a.preventDefault();var b=jQuery(a.target),c={username:b.find("[name=username]").val(),password:b.find("[name=password]").val(),security:jQuery("#security").val(),remember:b.find("[name=remember]").is(":checked")};if(!_.isEmpty(c.username)||!_.isEmpty(c.password)){var d=b.find("[type=submit]");return d.attr("disabled",!0),d.find("img").show(),$PeepSo.postJson("auth.login",c,function(a){d.removeAttr("disabled"),d.find("img").hide(),a.success?window.location=jQuery('input[name="redirect_to"]').val():!1===pswindow.acknowledge(a.errors,a.data.dialog_title)&&b.find(".errlogin").html(a.errors[0]).css("display","block")}),!1}};