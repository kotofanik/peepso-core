/*
 * PeepSo AJAX class
 * @package PeepSo
 * @aithor PeepSo
 */function PeepSo(){if("undefined"!=typeof peepsodata){this.defaultUrl=peepsodata.ajaxurl;this.userId=parseInt(peepsodata.userid)}}PeepSo.prototype={error:!1,errorText:"",errorStatus:"",callback:null,trxComplete:0,errorCallback:null,validationErrors:new Array,url:"",ret:0,timeout:0,enableValidation:1,formElementType:"td",async:!0,defaultUrl:null,userId:null,init:function(e,t){this.error=!1;this.errorText="";this.errorStatus="";this.callback=e;this.trxComplete=0;this.errorCallback=null;this.url=peepsodata.ajaxurl+t;this.timeout=0;this.enableValidation=1;this.async=!0},peepSoCallback:function(e){if(null===e){this.trxComplete=1;return}try{"undefined"!=typeof e.session_timeout}catch(t){}if(typeof e.focus!="undefined"&&e.focus!==null)if(document.getElementById(e.focus)!==null)document.getElementById(e.focus).focus();else{var n="#"+e.form+' [name="'+e.focus+'"]';jQuery(n).focus()}try{if(typeof e.errors!="undefined"){var r="";if(e.errors.length>0){for(x=0;x<e.errors.length;x++)typeof e.errors[x]["error"]!="undefined"&&(r+="<p>"+e.errors[x].error+"</p>");r!==""&&alert(r)}}if(typeof e.notices!="undefined"){var i="";if(e.notices.length>0){for(x=0;x<e.notices.length;x++)typeof e.notices[x]["message"]!="undefined"&&(i+=e.notices[x].message+"\n");i!==""&&alert(i)}}}catch(t){}typeof e.success!="undefined"&&e.success===1&&typeof e.form!="undefined"&&e.form!==""&&this.clearValidation(e.form);try{if(this.enableValidation&&typeof e.validation!="undefined"&&typeof e.form!="undefined"&&e.form!==""&&e.validation.length>0){this.clearValidation(e.form);var s=jQuery("#"+e.form);jQuery(s).addClass("validation-errors");for(x=0;x<e.validation.length;x++){var o=jQuery('[name="'+e.validation[x].fieldName+'"]');jQuery(o).addClass("validation-error");var u=o.closest(this.formElementType);u.append('<div class="validation-msg">'+e.validation[x].errorMessage+"</div>")}}}catch(t){}if(typeof this.callback=="function")try{this.callback(e)}catch(t){}this.trxComplete=1},clearValidation:function(e){e=jQuery("#"+e);jQuery(e).find("div.validation-msg").each(function(){jQuery(this).remove()});jQuery(e).find("input, select, textarea").each(function(){jQuery(this).removeClass("validation-error")});jQuery(e).find(this.formElementType+".errorItem").each(function(){jQuery(this).removeClass("errorItem")})},get:function(e,t,n,r){var i=new PeepSo,s=this.timeout;i.async=this.async;target_url=peepsodata.ajaxurl+e;$PeepSo.log("target=["+target_url+"]");i.init(n,e);if(typeof r=="undefined"||r==="")r="json";i.ret=jQuery.get(i.url,t,function(e){i.peepSoCallback(e)},r,{timeout:s},{async:i.async});return i},getJson:function(e,t,n){var r=new PeepSo;r.init(n,e);r.async=this.async;var i={type:"GET",url:r.url,contentType:"application/json; charset=utf-8",dataType:"json",data:t,success:function(e){r.peepSoCallback(e)},error:function(){r.ajaxError()},async:r.async};return jQuery.ajax(i)},post:function(e,t,n,r){var i=new PeepSo;i.init(n,e);i.errorCallback=this.errorCallback;i.enableValidation=this.enableValidation;i.async=this.async;i.timeout=this.timeout;if(typeof r=="undefined"||r==="")r="json";if(r==="json"){i.ret=this.postJson(e,t,n);return i}i.ret=jQuery.post(i.url,t,function(e){i.peepSoCallback(e)},r,{timeout:this.timeout},{async:i.async});return i},postElems:function(e,t,n,r){var i=new PeepSo;i.init(n,e);i.async=this.async;if(typeof r=="undefined"||r===null)r="json";var s=jQuery(t.container).find("input").serializeArray();s=jQuery.merge(s,jQuery(t.container).find("select").serializeArray());s=jQuery.merge(s,jQuery(t.container).find("textarea").serializeArray());s.push({name:"action",value:t.action});s.push({name:"req",value:t.req});i.ret=jQuery.post(i.url,s,function(e){i.peepSoCallback(e)},r,{async:i.async});return i},postJson:function(e,t,n){var r=new PeepSo;r.init(n,e);r.async=this.async;r.errorCallback=this.errorCallback;r.enableValidation=this.enableValidation;var i={type:"POST",url:r.url,dataType:"json",data:t,timeout:this.timeout,success:function(e){r.peepSoCallback(e)},error:function(){r.ajaxError()},async:r.async};r.ret=jQuery.post(i.url,t,function(e){i.success(e)},"json");return r},setTimeout:function(e){this.timeout=e;return this},setValidation:function(e){typeof e!="undefined"&&(e?this.enableValidation=1:this.enableValidation=0);return this},disableAsync:function(){this.async=!1;return this},setErrorCallback:function(e){this.errorCallback=e;return this},setFormElement:function(e){this.formElementType=e;return this},ajaxError:function(e,t,n){this.error=!0;typeof e=="undefined"?this.errorText="Timeout":this.errorText=e.responseText;this.errorStatus=t;$PeepSo.log("**ajax error "+this.errorStatus+": "+this.errorText);typeof this.errorCallback=="function"&&this.errorCallback()},log:function(e){window.console&&console.log(e)}};$PeepSo=new PeepSo;