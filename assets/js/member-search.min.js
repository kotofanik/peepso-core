function PsMemberSearch(){this.cur_req_string=""}function isElementInViewport(a){var b=a.getBoundingClientRect();return b.top>=0&&b.left>=0&&b.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&b.right<=(window.innerWidth||document.documentElement.clientWidth)}var ps_membersearch=new PsMemberSearch;PsMemberSearch.prototype.init=function(){var a=this;jQuery(".member-search-toggle").each(function(b,c){var d=jQuery("#ps-member-search-html").clone(),e=jQuery("input[name=query]",d),f=jQuery(c).psnotification({view_all_link:"javascript: ps_membersearch.view_all();",source:"membersearch.search",request:{per_page:10},fetch:function(b){return a.cur_req_string=this.popover_header.find("input").serialize(),a.query=this.popover_header.find("input[name=query]").val(),b=a.cur_req_string},after_load:function(){f._notifications&&f._notifications.length?(f.popover_footer.find("a").html(f._data.view_all_text),f.popover_footer.show()):f.popover_footer.hide()},paging:!1,lazy:!0,header:d}).on("notifications.shown",function(a,b){jQuery(".member-search-notice",d).toggleClass("hidden",b.popover_list.find("li").length>0)});f=f.data("plugin_psnotification"),f.popover_footer.hide(),e.on("input",_.debounce(function(a){var b=jQuery(a.target),c=jQuery.trim(b.val());return f.popover_header.find(".member-search-notice").addClass("hidden"),f.popover_footer.hide(),c?void b.closest(".member-search-toggle").psnotification("refresh"):void f.popover_list.find("li").remove()},250)),e.val()&&e.triggerHandler("input")})},PsMemberSearch.prototype.view_all=function(){var a=peepsodata.members_page;null!=this.query&&(a=a+"?query="+this.query),window.location=a},PsMemberSearch.prototype.filter=function(){var a,b,c,d=jQuery(".ps-js-members-sortby"),e=jQuery(".ps-js-members-gender"),f=jQuery(".ps-js-members-avatar");d.length&&(a=d.val().split("|"),b=a[0]||void 0,c=a[1]||void 0,this.load_members_ct&&this.load_members_ct.empty(),this.load_members_order_by=b,this.load_members_order=c,this.load_members_peepso_gender=e.val()||void 0,this.load_members_peepso_avatar=f[0].checked?1:void 0,this.load_members_page=1,this.load_members_end=!1,this.load_members())},PsMemberSearch.prototype.load_members=function(){var a={uid:peepsodata.currentuserid,user_id:peepsodata.userid,is_page:1,query:this.load_members_query||void 0,order_by:this.load_members_order_by,order:this.load_members_order,peepso_gender:this.load_members_peepso_gender,peepso_avatar:this.load_members_peepso_avatar,page:this.load_members_page};"undefined"==typeof this.load_members_ct&&(this.load_members_ct=jQuery(".ps-js-members")),this.load_members_ct.length&&(this.load_members_loading||this.load_members_end||(this.toggle_loading("show"),this.load_members_loading=!0,this.xhr&&this.xhr.abort(),this.xhr=$PeepSo.getJson("membersearch.search",a,jQuery.proxy(function(b){var c=b.data||{};b.success?(a.page<=1&&this.load_members_ct.empty(),this.load_members_ct.append(c.members.join("")),this.load_members_ct.find(".ps-js-beforeloaded").each(function(){jQuery(this).toggleClass("ps-js-beforeloaded loaded")}),c.members_page>=1&&this.load_members_page++):(this.load_members_end=!0,c.members_found>=1||this.load_members_ct.html(b.errors.join(""))),this.load_members_loading=!1,this.toggle_loading("hide")},this))))},PsMemberSearch.prototype.search=function(a){this.load_members_query=a,this.filter()},PsMemberSearch.prototype.autoscroll=function(){var a="scroll.ps-members",b=jQuery(".ps-js-members-triggerscroll"),c=jQuery(window);b.length&&c.off(a).on(a,jQuery.proxy(function(){!this.load_members_end&&isElementInViewport(b[0])&&this.load_members()},this))},PsMemberSearch.prototype.toggle_loading=function(a){"show"!==a&&(a="hide"),this.toggle_loading_el||(this.toggle_loading_el=jQuery(".ps-js-members-loading")),"hide"===a?this.toggle_loading_timer=setTimeout(jQuery.proxy(function(){this.toggle_loading_el.hide()},this),1e3):(clearTimeout(this.toggle_loading_timer),this.toggle_loading_el.show())},jQuery(document).ready(function(){ps_membersearch.init(),ps_membersearch.search(window.peepsomembersdata&&peepsomembersdata.search||void 0),ps_membersearch.autoscroll(),jQuery(".ps-js-members-query").on("input",_.debounce(function(a){ps_membersearch.search(a.target.value)},250)),jQuery(".ps-form-search-opt").on("click",function(){jQuery(".ps-js-page-filters").stop().slideToggle()})});