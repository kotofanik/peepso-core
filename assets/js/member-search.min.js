function PsMemberSearch(){this.cur_req_string=""}function isElementInViewport(a){var b=a.getBoundingClientRect();return b.top>=0&&b.left>=0&&b.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&b.right<=(window.innerWidth||document.documentElement.clientWidth)}var ps_membersearch=new PsMemberSearch;PsMemberSearch.prototype.init=function(){var a=this;jQuery(".member-search-toggle").each(function(b,c){var d=jQuery("#ps-member-search-html").clone(),e=jQuery("input[name=query]",d),f=jQuery(c).psnotification({view_all_link:"javascript: ps_membersearch.view_all();",source:"membersearch.search",request:{per_page:10},fetch:function(b){return a.cur_req_string=this.popover_header.find("input").serialize(),a.query=this.popover_header.find("input[name=query]").val(),b=a.cur_req_string},after_load:function(){f._notifications&&f._notifications.length?(f.popover_footer.find("a").html(f._data.view_all_text),f.popover_footer.show()):f.popover_footer.hide()},paging:!1,lazy:!0,header:d}).on("notifications.shown",function(a,b){jQuery(".member-search-notice",d).toggleClass("hidden",b.popover_list.find("li").length>0)});f=f.data("plugin_psnotification"),f.popover_footer.hide(),e.on("input",_.debounce(function(a){var b=jQuery(a.target),c=jQuery.trim(b.val());return f.popover_header.find(".member-search-notice").addClass("hidden"),f.popover_footer.hide(),c?void b.closest(".member-search-toggle").psnotification("refresh"):void f.popover_list.find("li").remove()},250)),e.val()&&e.triggerHandler("input")})},PsMemberSearch.prototype.view_all=function(){var a=peepsodata.members_page;null!=this.query&&(a=a+"?query="+this.query),window.location=a},PsMemberSearch.prototype.sortby=function(a){this.load_members_sort=a,this.load_members_page=1,this.load_members_end=!1,this.load_members()},PsMemberSearch.prototype.load_members=function(){var a={uid:peepsodata.currentuserid,user_id:peepsodata.userid,is_page:1,page:this.load_members_page,query:this.load_members_query||void 0};"undefined"==typeof this.load_members_ct&&(this.load_members_ct=jQuery(".ps-js-members--"+peepsodata.userid)),this.load_members_ct.length&&(this.load_members_loading||this.load_members_end||(this.load_members_loading=!0,this.xhr&&this.xhr.abort(),this.xhr=$PeepSo.getJson("membersearch.search",a,jQuery.proxy(function(b){var c=b.data||{};b.success?(a.page<=1&&this.load_members_ct.empty(),this.load_members_ct.append(c.members.join("")),this.load_members_ct.find(".ps-js-beforeloaded").each(function(){jQuery(this).toggleClass("ps-js-beforeloaded loaded")}),c.members_page>=1&&this.load_members_page++):(this.load_members_end=!0,c.members_found>=1||this.load_members_ct.html(b.errors.join(""))),this.load_members_loading=!1},this))))},PsMemberSearch.prototype.autoscroll=function(){var a="scroll.ps-members",b=jQuery(".ps-js-members-triggerscroll--"+peepsodata.userid),c=jQuery(window);b.length&&c.off(a).on(a,jQuery.proxy(function(){!this.load_members_end&&isElementInViewport(b[0])&&this.load_members()},this))},PsMemberSearch.prototype.search=function(a){a&&a.nodeType&&(a=jQuery(a).find("[name=query]").val()),this.load_members_query=a,this.sortby()},jQuery(document).ready(function(){ps_membersearch.init(),ps_membersearch.search(window.peepsomembersdata&&peepsomembersdata.search||void 0),ps_membersearch.autoscroll(),jQuery(".ps-js-members-query").on("input",_.debounce(function(a){ps_membersearch.search(a.target.value)},250))});