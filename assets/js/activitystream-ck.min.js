function PsActivity(){this.current_post=null}var activity=new PsActivity;PsActivity.prototype.init=function(a){},PsActivity.prototype.action_like=function(a){var b={postid:a,uid:peepsodata.currentuserid};return $PeepSo.postJson("activity.like",b,function(b){if(b.success){var c=b.data.html;jQuery("#act-like-"+a).html(c).show()}else alert(b.errors[0])}),!1},PsActivity.prototype.action_share=function(a){return!1},PsActivity.prototype.action_report=function(a){var b=jQuery("#activity-report-title").html(),c=jQuery("#activity-report-content").html(),d=jQuery(".ps-js-activity--"+a+" .cstream-attachment").html().trim()+"!~";d=d.replace("<p>","<span>").replace("</p>","<br/></span>").replace("<br/></span>!~","</span>"),c=c.replace("{post-content}",d),c=c.replace("{post-id}",a+""),pswindow.show(b,c)},PsActivity.prototype.submit_report=function(){var a=jQuery("#postbox-report-popup #postbox-post-id","#ps-window").val(),b=jQuery("#rep_reason option:selected","#ps-window").val(),c={postid:a,uid:peepsodata.currentuserid,reason:b},d=ps_observer.apply_filters("activitystream_notice_container",".ps-js-activity--"+a+" .cstream-more",a);return $PeepSo.getJson("activity.report",c,function(a){jQuery(d).html(a.notices[0])}),pswindow.hide(),!1},PsActivity.prototype.action_delete=function(a){var b={postid:a,uid:peepsodata.currentuserid};return $PeepSo.postJson("activity.delete",b,function(b){b.success&&jQuery(".ps-js-activity--"+a).remove()}),!1},PsActivity.prototype.comment_save=function(a){var b="#act-new-comment-"+a+" .cstream-form-text";jQuery("#act-new-comment-"+a+" .ps-comment-loading").show(),jQuery("#act-new-comment-"+a+" .ps-comment-actions").hide();var c=jQuery(b).val();return req={postid:a,uid:peepsodata.currentuserid,content:c},$PeepSo.postJson("activity.makecomment",req,function(b){b.success?jQuery("#act-comment-container-"+a).append(b.data.html):alert("problem posting comment"),activity.comment_cancel(a),activity.current_post=null,jQuery("#act-new-comment-"+a+" .ps-comment-loading").hide(),jQuery("#act-new-comment-"+a+" .ps-comment-actions").show()}),!1},PsActivity.prototype.comment_action_delete=function(a){var b={postid:a,uid:peepsodata.currentuserid};return $PeepSo.postJson("activity.delete",b,function(b){b.success&&jQuery("#comment-item-"+a).remove()}),!1},PsActivity.prototype.comment_action_report=function(a){var b=jQuery("#activity-report-title").html(),c=jQuery("#activity-report-content").html(),d=jQuery("#comment-item-"+a+" .comment").html().trim()+"!~";d=d.replace("<p>","<span>").replace("</p>","<br/></span>").replace("<br/></span>!~","</span>"),c=c.replace("{post-content}",d),c=c.replace("{post-id}",a+""),ps_observer.add_filter("activitystream_notice_container",function(a,b){return"#comment-item-"+b+" .cstream-more"},10,2),pswindow.show(b,c),jQuery("#ps-window").one("pswindow.hidden",function(){ps_observer.remove_filter("activitystream_notice_container",function(a,b){return"#comment-item-"+b+" .cstream-more"},10)})},PsActivity.prototype.comment_action_share=function(a){},PsActivity.prototype.comment_action_like=function(a){var b={postid:a,uid:peepsodata.currentuserid};return $PeepSo.postJson("activity.like",b,function(b){if(b.success){var c=b.data.html;jQuery("#comment-item-"+a).append(c)}else alert(b.errors[0])}),!1},PsActivity.prototype.comment_cancel=function(a){return jQuery("#act-new-comment-"+a+" .cstream-form-text").val(""),!1},PsActivity.prototype.show_likes=function(a){var b={postid:a,uid:peepsodata.currentuserid};return $PeepSo.postJson("activity.getlikes",b,function(b){jQuery("#act-like-"+a).html("several people like this")}),!1},PsActivity.prototype.show_comments=function(a){var b={postid:a,uid:peepsodata.currentuserid};return jQuery("#wall-cmt-"+a+" .comment-ajax-loader").toggleClass("hidden"),$PeepSo.getJson("activity.show_remaining_comments",b,function(b){jQuery("#wall-cmt-"+a+" .cstream-more").fadeOut(),jQuery("#wall-cmt-"+a+" .comment-ajax-loader").toggleClass("hidden"),jQuery("#act-comment-container-"+a).append(b.data.html)}),jQuery(this).hide(),!1},PsActivity.prototype.option_edit=function(a){var b={postid:a,uid:peepsodata.currentuserid};$PeepSo.postJson("activity.editpost",b,function(b){if(b.success){jQuery(".ps-js-activity--"+a+" .cstream-attachment").hide().after(b.data.html),jQuery(".ps-js-activity--"+a+" .cstream-content .cstream-edit textarea").autosize()}})},PsActivity.prototype.option_canceledit=function(a){var b=jQuery(".ps-js-activity--"+a);b.length>0&&(jQuery(".cstream-edit",b).remove(),jQuery(".cstream-attachment",b).show())},PsActivity.prototype.option_savepost=function(a){var b=jQuery(".ps-js-activity--"+a);if(b.length>0){var c=jQuery(".cstream-edit textarea",b).val();jQuery(".cstream-edit",b).remove();var d={postid:a,uid:peepsodata.currentuserid,post:c};$PeepSo.postJson("activity.savepost",d,function(a){jQuery(".cstream-attachment",b).html(a.data.html).show()})}},PsActivity.prototype.option_hide=function(a){var b={postid:a,uid:peepsodata.currentuserid};$PeepSo.postJson("activity.hidepost",b,function(b){b.success&&jQuery(".ps-js-activity--"+a).remove()})},PsActivity.prototype.option_block=function(a,b){var c={uid:peepsodata.currentuserid,user_id:b};$PeepSo.postJson("activity.blockuser",c,function(b){b.success&&jQuery(".ps-js-activity--"+a).remove()})},jQuery(document).ready(function(){activity.init()});