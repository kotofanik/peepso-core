function PsProfile(){this.cover={},this.cover.x_position_percent=0,this.cover.y_position_percent=0,this.initial_cover_position=jQuery("img#"+peepsodata.userid).attr("style")}var profile=new PsProfile;PsProfile.prototype.init=function(){var a=jQuery(".js-collapse-about-btn");0!==a.length&&a.on("click",function(a){a.preventDefault();var b=jQuery(".js-collapse-about"),c=b.css("display");"none"===c?b.show():b.hide()}),jQuery(".js-focus-cover").hover(function(){!1===pswindow.is_visible&&jQuery(".js-focus-change-cover").show()},function(){jQuery(".js-focus-change-cover").hide()}),jQuery(".ps-tab__bar").unbind("click")},PsProfile.prototype.activate_tab=function(a,b,c){return a.preventDefault(),jQuery(a.target).addClass("active").siblings("[data-toggle=tab]").removeClass("active"),jQuery(c).hide(),jQuery(b).show(),!1},PsProfile.prototype.new_like=function(){var a={likeid:peepsodata.userid,uid:peepsodata.currentuserid};return $PeepSo.postJson("profile.like",a,function(a){a.success?jQuery(".nav.profile-interactions").html(a.data.html):psmessage.show("",a.errors[0]).fade_out(psmessage.fade_time)}),!1},PsProfile.prototype.block_user=function(a,b){this.blocking_user||pswindow.confirm(peepsoprofiledata.label_confirm_block_user,jQuery.proxy(function(){pswindow.hide(),b&&(b=jQuery(b),b.find("img").css("display","inline"));var c={uid:peepsodata.currentuserid,user_id:a};this.blocking_user=!0,$PeepSo.postJson("activity.blockuser",c,jQuery.proxy(function(b){this.blocking_user=!1,b.success&&(jQuery(".ps-js-focus--"+a).find(".ps-focus-actions, .ps-focus-actions-mobile").html(b.data.actions),psmessage.show(b.data.header,b.data.message,psmessage.fade_time),b.data.redirect&&setTimeout(function(){window.location=b.data.redirect},Math.min(1e3,psmessage.fade_time)))},this))},this))},PsProfile.prototype.unblock_user=function(a,b){if(!this.unblocking_user){b&&(b=jQuery(b),b.find("img").css("display","inline"));var c={uid:peepsodata.currentuserid,user_id:a};this.unblocking_user=!0,$PeepSo.postJson("activity.unblockuser",c,jQuery.proxy(function(b){this.unblocking_user=!1,b.success&&(jQuery(".ps-js-focus--"+a).find(".ps-focus-actions, .ps-focus-actions-mobile").html(b.data.actions),psmessage.show(b.data.header,b.data.message,psmessage.fade_time))},this))}},PsProfile.prototype.report_user=function(){var a=jQuery("#activity-report-title").html(),b=jQuery("#activity-report-content").html();b=b.replace("{post-content}","Profile"),b=b.replace("{post-id}",peepsodata.userid+""),ps_observer.add_filter("activity_report_action",function(a){return"profile.report"},10,1),actions=jQuery("#activity-report-actions").html(),pswindow.show(a,b).set_actions(actions).refresh(),jQuery("#ps-window").one("pswindow.hidden",function(){ps_observer.remove_filter("activity_report_action",function(a){return"profile.report"},10)}),jQuery(window).one("report.submitted",function(a,b){pswindow.show("Profile Reported",b.notices[0])})},PsProfile.prototype.confirm_remove_cover_photo=function(){var a=jQuery("#delete-confirmation #delete-title").html(),b=jQuery("#delete-confirmation #delete-content").html();pswindow.show(a,b)},PsProfile.prototype.remove_cover_photo=function(a){var b={uid:peepsodata.currentuserid,user_id:a,_wpnonce:jQuery("#_covernonce").val()};$PeepSo.postJson("profile.remove_cover_photo",b,function(a){a.success&&window.location.reload()})},PsProfile.prototype.reposition_cover=function(){jQuery(".js-focus-gradient",".js-focus-cover").hide(),jQuery(".js-focus-change-cover > a",".js-focus-cover").hide(),jQuery(".reposition-cover-actions",".js-focus-cover").show(),jQuery(".js-focus-cover").addClass("ps-focus-cover-edit");var a=this,b=jQuery(".js-focus-cover").height()-jQuery("img#"+peepsodata.userid).height(),c=jQuery(".js-focus-cover").width()-jQuery("img#"+peepsodata.userid).width();jQuery("img#"+peepsodata.userid).draggable({cursor:"move",drag:function(a,d){d.position.top<b&&(d.position.top=b),d.position.top>0&&(d.position.top=0),d.position.left<c&&(d.position.left=c),d.position.left>0&&(d.position.left=0)},stop:function(b,c){var d=jQuery("img#"+peepsodata.userid),e=d.closest(".js-focus-cover"),f=100*c.position.top/e.height();f=Math.round(1e4*f)/1e4,y=100*c.position.left/e.width(),y=Math.round(1e4*y)/1e4,a.cover.x_position_percent=f,a.cover.y_position_percent=y,d.css("top",f+"%"),d.css("left",y+"%")}})},PsProfile.prototype.cancel_reposition_cover=function(){jQuery(".js-focus-gradient",".js-focus-cover").show(),jQuery(".js-focus-change-cover > a",".js-focus-cover").show(),jQuery(".reposition-cover-actions",".js-focus-cover").hide(),jQuery(".js-focus-cover").removeClass("ps-focus-cover-edit"),jQuery("img#"+peepsodata.userid).attr("style",this.initial_cover_position)},PsProfile.prototype.save_reposition_cover=function(){var a={user_id:peepsodata.userid,x:this.cover.x_position_percent,y:this.cover.y_position_percent,_wpnonce:jQuery("#_photononce").val()},b=this;jQuery(".reposition-cover-actions",".js-focus-cover").hide(),jQuery(".ps-reposition-loading",".js-focus-cover").show(),jQuery(".js-focus-cover").removeClass("ps-focus-cover-edit"),$PeepSo.postJson("profile.reposition_cover",a,function(a){jQuery(".ps-reposition-loading",".js-focus-cover").hide(),b.initial_cover_position=jQuery("img#"+peepsodata.userid).attr("style"),b.cancel_reposition_cover(),psmessage.show("",a.notices[0]).fade_out(psmessage.fade_time)})},PsProfile.prototype.confirm_remove_avatar=function(){var a=jQuery("#delete-confirmation #delete-title").html(),b=jQuery("#delete-confirmation #delete-content").html();pswindow.show(a,b)},PsProfile.prototype.remove_avatar=function(a){var b={uid:peepsodata.currentuserid,user_id:a,_wpnonce:jQuery("#_photononce").val()};$PeepSo.postJson("profile.remove_avatar",b,function(a){a.success&&window.location.reload()})},PsProfile.prototype.delete_profile=function(){var a=jQuery("#profile-delete-title").html(),b=jQuery("#profile-delete-content").html();pswindow.show(a,b)},PsProfile.prototype.delete_profile_action=function(){$req={};var a={uid:peepsodata.currentuserid};$PeepSo.postJson("profile.delete_profile",a,function(a){a.success?window.location=a.data.url:psmessage.show("",a.errors[0]).fade_out(psmessage.fade_time)})},PsProfile.prototype.show_avatar_dialog=function(){jQuery(".error-container").html("");var a=jQuery("#dialog-upload-avatar"),b=a.find("#dialog-upload-avatar-title").html(),c=a.find("#dialog-upload-avatar-content").html(),d=a.find(".dialog-action").html(),e=pswindow.show(b,c).set_actions(d),f=e.$container.find(".ps-dialog");f.addClass("ps-dialog-wide"),ps_observer.add_filter("pswindow_close",function(){f.removeClass("ps-dialog-wide")},10,1),this.init_avatar_fileupload(),jQuery("#ps-window").on("pswindow.hidden",function(){jQuery(".upload-avatar .fileupload:visible").fileupload("destroy")})},PsProfile.prototype.init_avatar_fileupload=function(){var a=this;jQuery(".upload-avatar .fileupload:visible").fileupload({formData:{user_id:peepsodata.userid,_wpnonce:jQuery("#_photononce").val()},dataType:"json",url:peepsodata.ajaxurl+"profile.upload_avatar?avatar",add:function(a,b){var c=/(\.|\/)(jpe?g|png)$/i;if(b.files[0].type.length&&!c.test(b.files[0].type)){var d=jQuery("#profile-avatar-error-filetype").text();jQuery(".error-container").html(d)}else if(parseInt(b.files[0].size)>peepsodata.upload_size){var e=jQuery("#profile-avatar-error-filesize").text();jQuery(".error-container").html(e)}else jQuery("#ps-window .ps-loading-image").show(),jQuery("#ps-window .show-avatar, #ps-window .show-thumbnail, #ps-window .upload-avatar").hide(),pswindow.refresh(),b.submit()},done:function(b,c){var d=c.result;if(d.success){var e=jQuery("#dialog-upload-avatar-content",jQuery(d.data.html)),f=jQuery("#dialog-upload-avatar .dialog-action").html(),g="?"+Math.random();jQuery(".js-focus-avatar img",e).attr("src",d.data.image_url+g),jQuery(".imagePreview img",e).attr("src",d.data.orig_image_url+g),jQuery(".imagePreview",e).after('<input type="hidden" name="is_tmp" value="1"/>'),jQuery(".ps-js-has-avatar",e).show(),jQuery(".ps-js-no-avatar",e).hide(),pswindow.set_content(e),pswindow.set_actions(f),jQuery("#imagePreview img").one("load",function(){pswindow.refresh()}),a.init_avatar_fileupload()}else jQuery("#ps-window .show-avatar, #ps-window .show-thumbnail, #ps-window .upload-avatar").show(),jQuery(".error-container").html(d.errors),jQuery("#ps-window .ps-loading-image").hide()}})},PsProfile.prototype.confirm_avatar=function(){var a={user_id:peepsodata.userid,_wpnonce:jQuery("#_photononce").val()};$PeepSo.postJson("profile.confirm_avatar",a,function(a){a.success&&window.location.reload()})},PsProfile.prototype.show_cover_dialog=function(){jQuery(".error-container").html("");var a=jQuery("#dialog-upload-cover"),b=a.find("#dialog-upload-cover-title").html(),c=a.find("#dialog-upload-cover-content").html();pswindow.show(b,c),this.init_cover_fileupload(),jQuery("#ps-window").on("pswindow.hidden",function(){jQuery(".upload-cover .fileupload:visible").fileupload("destroy")})},PsProfile.prototype.init_cover_fileupload=function(){var a=this;jQuery(".upload-cover .fileupload:visible").fileupload({formData:{user_id:peepsodata.userid,_wpnonce:jQuery("#_photononce").val()},dataType:"json",url:peepsodata.ajaxurl+"profile.upload_cover?cover",add:function(a,b){var c=/(\.|\/)(jpe?g|png)$/i;if(b.files[0].type.length&&!c.test(b.files[0].type)){var d=jQuery("#profile-cover-error-filetype").text();jQuery(".error-container").html(d)}else if(parseInt(b.files[0].size)>peepsodata.upload_size){var e=jQuery("#profile-cover-error-filesize").text();jQuery(".error-container").html(e)}else jQuery("#ps-window .ps-loading-image").show(),jQuery("#ps-window .upload-cover").hide(),b.submit()},done:function(b,c){var d=c.result;jQuery("#ps-window .ps-loading-image").hide(),jQuery("#ps-window .upload-cover").show(),d.success?(jQuery(".cover-image").attr("src",d.data.image_url+"?"+Math.random()).css("top","0").css("left","0").removeClass("default").addClass("has-cover"),pswindow.fade_out("slow"),jQuery("#profile-reposition-cover").show(),jQuery("#dialog-upload-cover-content").html(d.data.html),pswindow.set_content(jQuery("#dialog-upload-cover-content",d.data.html).html()),a.init_cover_fileupload()):jQuery(".error-container").html(d.errors)}})},jQuery(document).ready(function(){profile.init()});