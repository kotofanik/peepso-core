/*
 * Implementation of PeepSo's PostBox
 * @package PeepSo
 * @aithor PeepSo
 */// implementation of PeepSo's PostBox
//$PeepSo.log("postbox.js");
// delcare class
function PsPostBox(){this.$textarea=null;this.$access=null;this.$charcount=null;this.$save_button=null;this.$cancel_button=null;this.$activity_stream=null;this.text_length=4e3;this.media_found=!1}PsPostBox.prototype.init=function(){this.$textarea=jQuery("#ps-postbox");this.$access=jQuery("#postbox_acc");this.$charcount=jQuery("#post-charcount");this.$save_button=jQuery("#postbox-post");this.$cancel_button=jQuery("#postbox-cancel");this.$activity_stream=jQuery("#ps-activitystream");"undefinded"!=typeof peepsodata.postsize&&(this.text_length=peepsodata.postsize);jQuery("#post-charcount").html(this.text_length+"");this.$textarea.autosize().on("focus",function(e){postbox.on_focus()}).on("keyup",function(e){postbox.on_change()});this.$save_button.click(this.save_post);this.$cancel_button.click(postbox.cancel_post);jQuery("#postbox-privacy li a").click(function(e){var t=jQuery(e.target).closest("a"),n=jQuery("#privacy-tab"),r=jQuery("#postbox_acc"),i=n.find("a"),s=t.closest("#postbox-privacy");n.find("i").attr("class",t.find("i").attr("class"));r.val(t.attr("data-option-value"));i.html(t.html());s.hide()});jQuery("nav.ps-postbox-tab ul li a").click(postbox.clear_tabs)};PsPostBox.prototype.clear_tabs=function(){ps_observer.apply_filters("postbox_clear_tabs",null)};PsPostBox.prototype.privacy=function(){jQuery("#postbox-privacy").show()};PsPostBox.prototype.save_post=function(){var e={content:postbox.$textarea.val(),id:peepsodata.currentuserid,uid:peepsodata.userid,acc:postbox.$access.val(),type:"activity"};e=ps_observer.apply_filters("postbox_req",e);jQuery(".ps-postbox-loading").show();$PeepSo.postJson("postbox.post",e,function(e){if(e.success){postbox.$activity_stream.prepend(e.data.html);postbox.cancel_post();var t=e.data.post_id;jQuery("#peepso-wrap .ps-js-activity--"+t+" .dropdown-toggle").click(dropdown_toggle_click).on("mouseenter",dropdown_toggle_mouseenter);jQuery("#peepso-wrap .ps-js-activity--"+t+" .dropdown-menu a").click(dropdown_toggle_a_click)}jQuery(".ps-postbox-loading").hide();ps_observer.apply_filters("postbox_post_saved",null)})};PsPostBox.prototype.cancel_post=function(){postbox.$textarea.val("");postbox.on_change();ps_observer.apply_filters("postbox_post_saved",null)};PsPostBox.prototype.on_focus=function(){};PsPostBox.prototype.on_change=function(){var e=this.$textarea.val(),t=e.length;t=this.text_length-t;this.$charcount.html(t+"");t>=30?this.$charcount.removeClass("alert-info").removeClass("alert-error"):t<30?this.$charcount.addClass("alert-info"):t<20&&this.charcount.removeClass("alert-info").addClass("alert-error");t<this.text_length?this.$save_button.show():this.$save_button.hide()};var postbox=new PsPostBox;jQuery(document).ready(function(){postbox.init()});