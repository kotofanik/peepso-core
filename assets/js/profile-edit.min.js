function PsProfileAvatar(){this.g_crop={},this.g_coords={x:0,y:0,x2:0,y2:0,w:0,h:0},this.g_ias=null}var profileavatar=new PsProfileAvatar;PsProfileAvatar.prototype.setCoords=function(a){this.g_coords.x=a.x,this.g_coords.y=a.y,this.g_coords.x2=a.x2,this.g_coords.y2=a.y2,this.g_coords.w=a.w,this.g_coords.h=a.h},PsProfileAvatar.prototype.saveThumbnail=function(){var a=this;this.g_ias.setOptions({show:!1,hide:!0,enable:!1}),req={u:peepsodata.userid,x:this.g_coords.x,y:this.g_coords.y,x2:this.g_coords.x2,y2:this.g_coords.y2,width:jQuery("#cWindowContent .large-profile-pic").width(),height:jQuery("#cWindowContent .large-profile-pic").height(),_wpnonce:jQuery("#_photononce").val()},$PeepSo.get("profile.crop",req,function(b){b.success&&a.refreshThumbnail()}),jQuery("#cWindowContent .update-thumbnail").show(),jQuery("#cWindowContent .update-thumbnail-save").hide(),jQuery("#cWindowContent .update-thumbnail-guide").hide()},PsProfileAvatar.prototype.imgSelect=function(a,b){this.g_coords.x=b.x1,this.g_coords.y=b.y1,this.g_coords.x2=b.x2,this.g_coords.y2=b.y2,this.g_coords.w=b.width,this.g_coords.h=b.height},PsProfileAvatar.prototype.updateThumbnail=function(){var a=this;this.g_ias=jQuery("#cWindowContent .large-profile-pic").imgAreaSelect({aspectRatio:"1:1",handles:!0,instance:!0,onSelectChange:function(b,c){a.imgSelect(b,c)}}),this.g_ias.setOptions({show:!0,hide:!1,enable:!0}),this.g_ias.update(),jQuery("#cWindowContent .update-thumbnail").hide(),jQuery("#cWindowContent .update-thumbnail-save").show(),jQuery("#cWindowContent .update-thumbnail-guide").show()},PsProfileAvatar.prototype.refreshThumbnail=function(){var a=Math.random(),b=jQuery("#cWindowContent .thumbnail-profile-pic").attr("src");jQuery("#cWindowContent .thumbnail-profile-pic").attr("src",b+"?"+a);var b=jQuery(".js-focus-avatar img").attr("src"),c=b.split("?",1);jQuery(".js-focus-avatar img").attr("src",c+"?"+a);var d=document.getElementById("ps-profile-avatar-iframe");d.innerHTML=d.innerHTML;var e=jQuery("#ps-profile-avatar-iframe"),b=e.attr("src");if(e.attr("src",b),-1!==b.indexOf("/peepso/assets/images/user")){var f=jQuery(".js-focus-avatar img").attr("src");f.replace("-full.jpg",".jpg"),b=f}var g=jQuery("img.cavatar");jQuery.each(g,function(b,c){var d=jQuery(c).data("author");if(d=parseInt(d),d===peepsodata.currentuserid){var e=jQuery(c).attr("src");e.indexOf("?")>0&&(e=e.split("?",1)),jQuery(c).attr("src",e+"?"+a)}})},PsProfileAvatar.prototype.cleanup_after_imgareaslect=function(){jQuery(".imgareaselect-selection").parent().hide(),jQuery(".imgareaselect-outer").hide()},jQuery(document).ready(function(a){jQuery("#large-profile-pic").load(function(){var a=this.clientHeight,b=160;160>a&&(b=a),a>160&&(a=160)}),ps_observer.add_filter("pswindow_close",function(){profileavatar.cleanup_after_imgareaslect()})});